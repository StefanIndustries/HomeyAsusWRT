<!DOCTYPE html>
<html lang="en">
<head>
    <script
            type="text/javascript"
            src="/homey.js"
            data-origin="settings"
    ></script>
</head>
<body>
<fieldset class="homey-form-fieldset">
    <legend class="homey-form-legend">Asus WRT Settings</legend>

    <div class="homey-form-group">
        <label class="homey-form-label" for="update-interval">Update Interval (seconds)</label>
        <input class="homey-form-input" id="update-interval" type="number" value=""/>
    </div>

    <div class="homey-form-group">
        <input class="homey-form-input" id="is-self-signed-certificate" type="checkbox"/>
        <label class="homey-form-label" for="is-self-signed-certificate" style="display: inline">
            Allow self-signed certificate
        </label>
    </div>
</fieldset>

<button id="save" class="homey-button-primary-full">Save</button>

<script type="text/javascript">
  function onHomeyReady(Homey) {
    const updateInterval = document.getElementById('update-interval');
    const isSelfSignedCertificate = document.getElementById('is-self-signed-certificate');
    const saveElement = document.getElementById('save');

    Homey.get('pollingInterval', function(err, interval) {
      if (err || interval === null) {
        updateInterval.value = 60;
      } else {
        updateInterval.value = interval / 1000;
      }
    });

    Homey.get('isSelfSignedCertificate', function(err, value) {
      if (err || value === null) {
        isSelfSignedCertificate.checked = false;
      } else {
        isSelfSignedCertificate.checked = value;
      }
    });

    saveElement.addEventListener('click', function(e) {
      Homey.set('pollingInterval', updateInterval.value * 1000, function(err) {
        if (err) {
          return Homey.alert(err);
        } else {
          // close html page
        }
      });
      Homey.set('isSelfSignedCertificate', isSelfSignedCertificate.checked, function(err) {
        if (err) {
          return Homey.alert(err);
        } else {
          // close html page
        }
      });
    });

    Homey.ready();
  }
</script>
</body>
</html>